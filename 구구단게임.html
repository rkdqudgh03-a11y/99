<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ ë‚˜ëŠ” êµ¬êµ¬ë‹¨ ê²Œì„!</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'GmarketSansMedium', 'Pretendard', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
            color: #333;
            text-align: center;
        }

        /* ê²Œì„ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ */
        #game-container {
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            background-color: white;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #007bff;
            margin-bottom: 20px;
        }

        /* í™”ë©´ ì „í™˜ ì‹œ ë¶€ë“œëŸ¬ìš´ íš¨ê³¼ */
        .screen {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  í™”ë©´ ìˆ¨ê¹€ */
        }

        .screen.active {
            display: block; /* active í´ë˜ìŠ¤ê°€ ìˆëŠ” í™”ë©´ë§Œ ë³´ì—¬ì¤Œ */
        }
        
        /* êµ¬êµ¬ë‹¨ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .dan-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .dan-btn {
            padding: 15px 10px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .dan-btn:hover {
            background-color: #e9ecef;
        }
        
        .dan-btn.selected {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }

        /* ë¬¸ì œ ë° ì •ë‹µ ì…ë ¥ë€ ìŠ¤íƒ€ì¼ */
        #problem-area {
            font-size: 3rem;
            font-weight: bold;
            margin: 30px 0;
            color: #343a40;
        }

        #answer-input {
            width: 100px;
            padding: 10px;
            font-size: 2rem;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 10px;
        }

        /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .action-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background-color: #28a745;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background-color: #218838;
        }

        /* ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ëŠ” ë²„íŠ¼ */
        #level-up-btn {
            background-color: #ffc107;
            color: #333;
        }
        #level-up-btn:hover {
            background-color: #e0a800;
        }

        /* ê²Œì„ ì •ë³´ í‘œì‹œ (ì ìˆ˜, ë‹¨ê³„ ë“±) */
        #game-info {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 1.1rem;
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 10px;
        }
        
        /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #message {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
            height: 30px;
        }
        
        .correct { color: #28a745; }
        .incorrect { color: #dc3545; }

    </style>
</head>
<body>

    <div id="game-container">
        <h1>ì‹ ë‚˜ëŠ” êµ¬êµ¬ë‹¨ ê²Œì„!</h1>

        <div id="beginner-setup" class="screen active">
            <h2>ì´ˆë³´ ë‹¨ê³„</h2>
            <p>ê°€ì¥ ì–´ë ¤ìš´ êµ¬êµ¬ë‹¨ì„ 1ê°œ ì„ íƒí•˜ì„¸ìš”.</p>
            <div id="beginner-selector" class="dan-selector"></div>
            <button id="start-beginner-btn" class="action-btn">ì´ˆë³´ ë‹¨ê³„ ì‹œì‘!</button>
        </div>

        <div id="intermediate-setup" class="screen">
            <h2>ì¤‘ìˆ˜ ë‹¨ê³„</h2>
            <p>ì—°ìŠµí•  êµ¬êµ¬ë‹¨ 5ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <div id="intermediate-selector" class="dan-selector"></div>
            <button id="start-intermediate-btn" class="action-btn">ì¤‘ìˆ˜ ë‹¨ê³„ ì‹œì‘!</button>
        </div>

        <div id="expert-setup" class="screen">
            <h2>ê³ ìˆ˜ ë‹¨ê³„</h2>
            <p>ì´ì œ ëª¨ë“  êµ¬êµ¬ë‹¨(1ë‹¨~9ë‹¨)ì—ì„œ ë¬¸ì œê°€ ë‚˜ì˜µë‹ˆë‹¤!</p>
            <button id="start-expert-btn" class="action-btn">ê³ ìˆ˜ ë‹¨ê³„ ì‹œì‘!</button>
        </div>

        <div id="game-play" class="screen">
            <div id="problem-area">3 X 5 = ?</div>
            <input type="number" id="answer-input" autofocus>
            <button id="submit-btn" class="action-btn">ì •ë‹µ í™•ì¸</button>
            <div id="message"></div>
            <div id="game-info">
                <span>ë‹¨ê³„: <b id="current-stage-display">ì´ˆë³´</b></span>
                <span>ì ìˆ˜: <b id="score-display">0</b></span>
                <span>ì—°ì† ì •ë‹µ: <b id="streak-display">0</b></span>
            </div>
        </div>
        
        <div id="level-up" class="screen">
            <h2>ì •ë§ ì˜í•˜ì‹œë„¤ìš”!</h2>
            <button id="level-up-btn" class="action-btn">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
        </div>
        
         <div id="game-clear" class="screen">
            <h2>ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <p>ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</p>
            <button id="restart-btn" class="action-btn">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
        </div>

    </div>

    <script>
        // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const screens = document.querySelectorAll('.screen');
        const beginnerSelector = document.getElementById('beginner-selector');
        const intermediateSelector = document.getElementById('intermediate-selector');
        
        const problemArea = document.getElementById('problem-area');
        const answerInput = document.getElementById('answer-input');
        const messageDiv = document.getElementById('message');
        
        const stageDisplay = document.getElementById('current-stage-display');
        const scoreDisplay = document.getElementById('score-display');
        const streakDisplay = document.getElementById('streak-display');
        
        // --- ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸° ---
        const startBeginnerBtn = document.getElementById('start-beginner-btn');
        const startIntermediateBtn = document.getElementById('start-intermediate-btn');
        const startExpertBtn = document.getElementById('start-expert-btn');
        const submitBtn = document.getElementById('submit-btn');
        const levelUpBtn = document.getElementById('level-up-btn');
        const restartBtn = document.getElementById('restart-btn');

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let currentStage = 'ì´ˆë³´';
        let selectedDan = [];
        let currentAnswer = 0;
        let score = 0;
        let consecutiveCorrect = 0;

        // --- í•¨ìˆ˜ ì •ì˜ ---

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // êµ¬êµ¬ë‹¨ ì„ íƒ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
        function createDanButtons(container, maxSelection) {
            container.innerHTML = '';
            for (let i = 1; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.classList.add('dan-btn');
                btn.textContent = `${i}ë‹¨`;
                btn.dataset.dan = i;
                
                btn.addEventListener('click', () => {
                    if (maxSelection === 1) {
                        // 1ê°œë§Œ ì„ íƒ ê°€ëŠ¥ (ì´ˆë³´)
                        const allBtns = container.querySelectorAll('.dan-btn');
                        allBtns.forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        selectedDan = [parseInt(btn.dataset.dan)];
                    } else {
                        // ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥ (ì¤‘ìˆ˜)
                        if (btn.classList.contains('selected')) {
                            btn.classList.remove('selected');
                        } else {
                            if (container.querySelectorAll('.selected').length < maxSelection) {
                                btn.classList.add('selected');
                            } else {
                                alert(`${maxSelection}ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”!`);
                            }
                        }
                    }
                });
                container.appendChild(btn);
            }
        }
        
        // ë¬¸ì œ ìƒì„± í•¨ìˆ˜
        function generateProblem() {
            let dan;
            if (currentStage === 'ê³ ìˆ˜') {
                dan = Math.floor(Math.random() * 9) + 1; // 1~9
            } else {
                const randomIndex = Math.floor(Math.random() * selectedDan.length);
                dan = selectedDan[randomIndex];
            }
            
            const num2 = Math.floor(Math.random() * 9) + 1; // 1~9 ê³±í•˜ê¸°
            currentAnswer = dan * num2;
            problemArea.textContent = `${dan} X ${num2} = ?`;
            answerInput.value = '';
            answerInput.focus();
        }

        // ê²Œì„ ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDisplay() {
            stageDisplay.textContent = currentStage;
            scoreDisplay.textContent = score;
            streakDisplay.textContent = consecutiveCorrect;
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = type; // 'correct' ë˜ëŠ” 'incorrect'
            setTimeout(() => { messageDiv.textContent = '' }, 1500);
        }

        // ì •ë‹µ í™•ì¸ ë° ì²˜ë¦¬ í•¨ìˆ˜
        function checkAnswer() {
            const userAnswer = parseInt(answerInput.value);
            if (isNaN(userAnswer)) {
                showMessage('ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'incorrect');
                return;
            }

            if (userAnswer === currentAnswer) {
                // ì •ë‹µ
                showMessage('ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰', 'correct');
                score += 1;
                consecutiveCorrect += 1;

                if ((currentStage !== 'ê³ ìˆ˜') && (score >= 10 || consecutiveCorrect >= 5)) {
                    showScreen('level-up');
                } else {
                    generateProblem();
                }
            } else {
                // ì˜¤ë‹µ
                showMessage(`ì•„ì‰¬ì›Œìš”! ì •ë‹µì€ ${currentAnswer}ì…ë‹ˆë‹¤.`, 'incorrect');
                score = Math.max(0, score - 2); // 0ì  ë°‘ìœ¼ë¡œ ì•ˆ ë‚´ë ¤ê°
                consecutiveCorrect = 0;
                generateProblem();
            }
            updateDisplay();
        }

        // ê²Œì„ ì‹œì‘ ë° ë‹¨ê³„ ì„¤ì • í•¨ìˆ˜
        function startGame() {
            score = 0;
            consecutiveCorrect = 0;
            updateDisplay();
            generateProblem();
            showScreen('game-play');
        }
        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

        // ì´ˆë³´ ë‹¨ê³„ ì‹œì‘ ë²„íŠ¼
        startBeginnerBtn.addEventListener('click', () => {
            if (selectedDan.length === 0) {
                alert('êµ¬êµ¬ë‹¨ì„ 1ê°œ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            startGame();
        });

        // ì¤‘ìˆ˜ ë‹¨ê³„ ì‹œì‘ ë²„íŠ¼
        startIntermediateBtn.addEventListener('click', () => {
            selectedDan = [];
            const selectedBtns = intermediateSelector.querySelectorAll('.selected');
            if (selectedBtns.length !== 5) {
                alert('êµ¬êµ¬ë‹¨ì„ 5ê°œ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            selectedBtns.forEach(btn => {
                selectedDan.push(parseInt(btn.dataset.dan));
            });
            startGame();
        });
        
        // ê³ ìˆ˜ ë‹¨ê³„ ì‹œì‘ ë²„íŠ¼
        startExpertBtn.addEventListener('click', () => {
            selectedDan = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            startGame();
        });

        // ì •ë‹µ ì œì¶œ ë²„íŠ¼
        submitBtn.addEventListener('click', checkAnswer);
        answerInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ê°€ê¸° ë²„íŠ¼
        levelUpBtn.addEventListener('click', () => {
            if (currentStage === 'ì´ˆë³´') {
                currentStage = 'ì¤‘ìˆ˜';
                createDanButtons(intermediateSelector, 5);
                showScreen('intermediate-setup');
            } else if (currentStage === 'ì¤‘ìˆ˜') {
                currentStage = 'ê³ ìˆ˜';
                showScreen('expert-setup');
            }
        });
        
        // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼
        restartBtn.addEventListener('click', () => {
            currentStage = 'ì´ˆë³´';
            selectedDan = [];
            createDanButtons(beginnerSelector, 1);
            showScreen('beginner-setup');
        });

        // --- ì´ˆê¸°í™” ---
        function init() {
            createDanButtons(beginnerSelector, 1);
            showScreen('beginner-setup');
        }

        init(); // ê²Œì„ ì‹œì‘!

    </script>
</body>
</html>